@inject UserManagementService UserManagementService
@inject RoleAttributeService RoleAttributeService
@rendermode InteractiveServer

<h3>Rolenverwaltung</h3>

<select class="form-select" @onchange="async (e) => await OnChangedRole(e.Value?.ToString())">
    <option value="">Auswahl</option>
    @foreach(var role in roles)
    {
        <option value="@role.Id">@role.Name</option>
    }
</select>

@if (!string.IsNullOrEmpty(selectedId))
{
    <div class="row" style="margin-top:10px;">
        <div class="col">
            <label for="mediaControl">Medienfeatures: </label>
            <div id="mediaControl" class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" checked="@IsMediaControlEnabled" id="switchMediaControl" @onchange="OnMediaControlChanged" />
            </div>
        </div>
    </div>

}


@code {
    List<RoleDto> roles = new();
    RoleAttributes roleAttribute = new();
    List<UserDto> users = new();

    string selectedId = "";
    private bool IsMediaControlEnabled = false;

    private async Task OnMediaControlChanged(ChangeEventArgs e)
    {
        IsMediaControlEnabled = (bool)e.Value;

        await AddRoleAttributes(IsMediaControlEnabled);
    }

    protected override async Task OnInitializedAsync()
    {
        await LoadRoles();
    }

    private async Task LoadRoles()
    {
        roles = await UserManagementService.GetRoles();
    }

    private async Task LoadRoleAttributes()
    {
        roleAttribute = await RoleAttributeService.GetRoleAttribute(selectedId, "MediaControl");
        IsMediaControlEnabled = roleAttribute?.Value == true;
    }

    private async Task OnChangedRole(string role)
    {
        selectedId = role;
        await LoadRoleAttributes();
    }

    private async Task AddRoleAttributes(bool isActive)
    {
        await RoleAttributeService.AddRoleAttributes(selectedId, "MediaControl", isActive);
    }

}
